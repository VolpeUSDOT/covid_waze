cr_type_size <- dbGetQuery(conn = con, statement = qry)
dim(cr_type_size) #62*11
ggplot(cr_type_size, aes(GM_CO2_RANK, CRASH_RATE, colour = SMARTWAY_RANKING_CATEGORY)) +
geom_line() + geom_point(aes(size = NBR_CARRIER)) +
facet_wrap(~ SMARTWAY_RANKING_CATEGORY)+
theme(legend.position="none")
ggplot(cr_type_size, aes(GM_CO2_RANK, CRASH_RATE, colour = SMARTWAY_RANKING_CATEGORY)) +
geom_line() + geom_point(aes(size = NBR_CARRIER)) +
facet_wrap(~ CARRIER_GROUP_ID)+
theme(legend.position="none")
ggplot(cr_type_size, aes(GM_CO2_RANK, CRASH_RATE, colour = CARRIER_GROUP_ID)) +
geom_line() + geom_point(aes(size = NBR_CARRIER)) +
facet_wrap(~ SMARTWAY_RANKING_CATEGORY)+
theme(legend.position="none")
ggplot(cr_type_size, aes(GM_CO2_RANK, CRASH_RATE, colour = CARRIER_GROUP_ID)) +
geom_line() + geom_point(aes(size = NBR_CARRIER)) +
facet_wrap(~ SMARTWAY_RANKING_CATEGORY)
cr_type_size$CARRIER_GROUP_ID <- as.factor(cr_type_size$CARRIER_GROUP_ID)
ggplot(cr_type_size, aes(GM_CO2_RANK, CRASH_RATE, colour = CARRIER_GROUP_ID)) +
geom_line() + geom_point(aes(size = NBR_CARRIER)) +
facet_wrap(~ SMARTWAY_RANKING_CATEGORY)
ggplot(cr_type_size, aes(GM_CO2_RANK, CRASH_RATE, colour = CARRIER_GROUP_ID)) +
geom_line() + geom_point(aes(size = PU_GROUP)) +
facet_wrap(~ SMARTWAY_RANKING_CATEGORY)+
theme(legend.position="none")
ggplot(cr_type_size, aes(GM_CO2_RANK, CRASH_RATE, colour = CARRIER_GROUP_ID)) +
geom_line() + geom_point(aes(size = PU_GROUP)) +
facet_wrap(~ SMARTWAY_RANKING_CATEGORY)
# each category - individual graph
ggplot(cr_type_size, aes(GM_CO2_RANK, CRASH_RATE, colour = CARRIER_GROUP_ID)) +
geom_line() + geom_point(aes(size = NBR_CARRIER)) +
facet_wrap(~ SMARTWAY_RANKING_CATEGORY + PU_GROUP)
# each category - individual graph
ggplot(cr_type_size, aes(GM_CO2_RANK, CRASH_RATE, colour = CARRIER_GROUP_ID)) +
geom_line() + geom_point(aes(size = NBR_CARRIER)) +
facet_wrap(~ PU_GROUP)
# each category - individual graph
ggplot(cr_type_size, aes(GM_CO2_RANK, CRASH_RATE, colour = PU_GROUP)) +
geom_line() + geom_point(aes(size = NBR_CARRIER)) +
facet_wrap(~ SMARTWAY_RANKING_CATEGORY )
# each category - individual graph
ggplot(cr_type_size, aes(GM_CO2_RANK, CRASH_RATE, colour = PU_GROUP)) +
geom_line() + geom_point(aes(size = NBR_CARRIER)) +
facet_wrap(~ SMARTWAY_RANKING_CATEGORY + CARRIER_GROUP_ID)
# each category - individual graph
ggplot(cr_type_size %>% filter(CARRIER_GROUP_ID == 1), aes(GM_CO2_RANK, CRASH_RATE, colour = PU_GROUP)) +
geom_line() + geom_point(aes(size = NBR_CARRIER)) +
facet_wrap(~ SMARTWAY_RANKING_CATEGORY)
# each category - individual graph
ggplot(cr_type_size %>% filter(CARRIER_GROUP_ID == 1), aes(GM_CO2_RANK, CRASH_RATE, colour = PU_GROUP)) +
geom_line() + geom_point(aes(size = NBR_CARRIER)) +
facet_wrap(~ SMARTWAY_RANKING_CATEGORY) +
title("Straight Carriers")
# each category - individual graph
ggplot(cr_type_size %>% filter(CARRIER_GROUP_ID == 1), aes(GM_CO2_RANK, CRASH_RATE, colour = PU_GROUP)) +
geom_line() + geom_point(aes(size = NBR_CARRIER)) +
facet_wrap(~ SMARTWAY_RANKING_CATEGORY) +
ggtitle("Straight Carriers")
ggplot(cr_type_size %>% filter(CARRIER_GROUP_ID == 2), aes(GM_CO2_RANK, CRASH_RATE, colour = PU_GROUP)) +
geom_line() + geom_point(aes(size = NBR_CARRIER)) +
facet_wrap(~ SMARTWAY_RANKING_CATEGORY) +
ggtitle("Combination Carriers")
ggplot(cr_type_size %>% filter(CARRIER_GROUP_ID == 1 & PU_GROUP == 1), aes(GM_CO2_RANK, CRASH_RATE, colour = PU_GROUP)) +
geom_line() + geom_point(aes(size = NBR_CARRIER)) +
facet_wrap(~ SMARTWAY_RANKING_CATEGORY) +
ggtitle("Straight Carriers")
ggplot(cr_type_size %>% filter(CARRIER_GROUP_ID == 1 & PU_GROUP == 2), aes(GM_CO2_RANK, CRASH_RATE, colour = PU_GROUP)) +
geom_line() + geom_point(aes(size = NBR_CARRIER)) +
facet_wrap(~ SMARTWAY_RANKING_CATEGORY) +
ggtitle("Straight Carriers")
ggplot(cr_type_size %>% filter(CARRIER_GROUP_ID == 1 & PU_GROUP == 3), aes(GM_CO2_RANK, CRASH_RATE, colour = PU_GROUP)) +
geom_line() + geom_point(aes(size = NBR_CARRIER)) +
facet_wrap(~ SMARTWAY_RANKING_CATEGORY) +
ggtitle("Straight Carriers")
ggplot(cr_type_size %>% filter(CARRIER_GROUP_ID == 1 & PU_GROUP == 4), aes(GM_CO2_RANK, CRASH_RATE, colour = PU_GROUP)) +
geom_line() + geom_point(aes(size = NBR_CARRIER)) +
facet_wrap(~ SMARTWAY_RANKING_CATEGORY) +
ggtitle("Straight Carriers")
ggplot(cr_type_size %>% filter(CARRIER_GROUP_ID == 1 & PU_GROUP == 5), aes(GM_CO2_RANK, CRASH_RATE, colour = PU_GROUP)) +
geom_line() + geom_point(aes(size = NBR_CARRIER)) +
facet_wrap(~ SMARTWAY_RANKING_CATEGORY) +
ggtitle("Straight Carriers")
ggplot(cr_type_size %>% filter(CARRIER_GROUP_ID == 2 & PU_GROUP == 5), aes(GM_CO2_RANK, CRASH_RATE, colour = PU_GROUP)) +
geom_line() + geom_point(aes(size = NBR_CARRIER)) +
facet_wrap(~ SMARTWAY_RANKING_CATEGORY) +
ggtitle("Combination Carriers")
ggplot(cr_type_size %>% filter(CARRIER_GROUP_ID == 2 & PU_GROUP == 5), aes(GTM_CO2_RANK, CRASH_RATE, colour = PU_GROUP)) +
geom_line() + geom_point(aes(size = NBR_CARRIER)) +
facet_wrap(~ SMARTWAY_RANKING_CATEGORY) +
ggtitle("Combination Carriers")
ggplot(cr_type_size %>% filter(CARRIER_GROUP_ID == 2 & PU_GROUP == 5), aes(GM_CO2_RANK, CRASH_RATE, colour = PU_GROUP)) +
geom_line() + geom_point(aes(size = NBR_CARRIER)) +
facet_wrap(~ SMARTWAY_RANKING_CATEGORY) +
ggtitle("Combination Carriers")
ggplot(cr_type_size %>% filter(CARRIER_GROUP_ID == 2 & PU_GROUP == 4), aes(GM_CO2_RANK, CRASH_RATE, colour = PU_GROUP)) +
geom_line() + geom_point(aes(size = NBR_CARRIER)) +
facet_wrap(~ SMARTWAY_RANKING_CATEGORY) +
ggtitle("Combination Carriers")
ggplot(cr_type_size %>% filter(CARRIER_GROUP_ID == 2 & PU_GROUP == 3), aes(GM_CO2_RANK, CRASH_RATE, colour = PU_GROUP)) +
geom_line() + geom_point(aes(size = NBR_CARRIER)) +
facet_wrap(~ SMARTWAY_RANKING_CATEGORY) +
ggtitle("Combination Carriers")
ggplot(cr_type_size %>% filter(CARRIER_GROUP_ID == 2 & PU_GROUP == 2), aes(GM_CO2_RANK, CRASH_RATE, colour = PU_GROUP)) +
geom_line() + geom_point(aes(size = NBR_CARRIER)) +
facet_wrap(~ SMARTWAY_RANKING_CATEGORY) +
ggtitle("Combination Carriers")
ggplot(cr_type_size %>% filter(CARRIER_GROUP_ID == 2 & PU_GROUP == 1), aes(GM_CO2_RANK, CRASH_RATE, colour = PU_GROUP)) +
geom_line() + geom_point(aes(size = NBR_CARRIER)) +
facet_wrap(~ SMARTWAY_RANKING_CATEGORY) +
ggtitle("Combination Carriers")
ggplot(cr_type_size %>% filter(CARRIER_GROUP_ID == 1 & PU_GROUP == 1), aes(GM_CO2_RANK, CRASH_RATE, colour = PU_GROUP)) +
geom_line() + geom_point(aes(size = NBR_CARRIER)) +
facet_wrap(~ SMARTWAY_RANKING_CATEGORY) +
ggtitle("Straight Carriers")
ggplot(cr_type_size %>% filter(CARRIER_GROUP_ID == 1 & PU_GROUP == 2), aes(GM_CO2_RANK, CRASH_RATE, colour = PU_GROUP)) +
geom_line() + geom_point(aes(size = NBR_CARRIER)) +
facet_wrap(~ SMARTWAY_RANKING_CATEGORY) +
ggtitle("Straight Carriers")
ggplot(cr_type_size %>% filter(CARRIER_GROUP_ID == 1 & PU_GROUP == 3), aes(GM_CO2_RANK, CRASH_RATE, colour = PU_GROUP)) +
geom_line() + geom_point(aes(size = NBR_CARRIER)) +
facet_wrap(~ SMARTWAY_RANKING_CATEGORY) +
ggtitle("Straight Carriers")
ggplot(cr_type_size %>% filter(CARRIER_GROUP_ID == 1 & PU_GROUP == 4), aes(GM_CO2_RANK, CRASH_RATE, colour = PU_GROUP)) +
geom_line() + geom_point(aes(size = NBR_CARRIER)) +
facet_wrap(~ SMARTWAY_RANKING_CATEGORY) +
ggtitle("Straight Carriers")
ggplot(cr_type_size %>% filter(CARRIER_GROUP_ID == 1 & PU_GROUP == 5), aes(GM_CO2_RANK, CRASH_RATE, colour = PU_GROUP)) +
geom_line() + geom_point(aes(size = NBR_CARRIER)) +
facet_wrap(~ SMARTWAY_RANKING_CATEGORY) +
ggtitle("Straight Carriers")
ggplot(cr_type_size %>% filter(CARRIER_GROUP_ID == 2 & PU_GROUP == 1), aes(GM_CO2_RANK, CRASH_RATE, colour = PU_GROUP)) +
geom_line() + geom_point(aes(size = NBR_CARRIER)) +
facet_wrap(~ SMARTWAY_RANKING_CATEGORY) +
ggtitle("Combination Carriers")
# Load data
qry <- paste0("WITH my_data AS (
SELECT A.*, B.PERCENTILE, B.RD_DEFICIENT, B.BASIC_ID
FROM SMARTWAY_JOIN_MCMIS A,     CSA.HIST_CARRIER_MEASURE B,
(SELECT DOT_NUMBER, ROUND(NVL(fatal_crash_total,0)/AVG_POWER_UNIT,2) FATAL_CR,
ROUND(NVL(inj_crash_total,0)/AVG_POWER_UNIT,2) INJURY_CR,
ROUND(NVL(towaway_crash_total,0)/AVG_POWER_UNIT,2) TOWAWAY_CR
FROM CSA.HIST_CARRIER
WHERE dot_number IN (SELECT DOT_NUMBER FROM CC_JOINED_LIST_NACFE
WHERE CR_INCLUDE = 'Y')) C
WHERE A.DOT_NUMBER = B.DOT_NUMBER
AND A.DOT_NUMBER = C.DOT_NUMBER
AND B.RELEASED_ID = 181
)
SELECT *
FROM my_data
PIVOT (
MAX( PERCENTILE) As PERCENTILE,
MAX( RD_DEFICIENT ) as RD_DEFICIENT
FOR BASIC_ID IN (11 as UD, 12 As HOS , 13 As DA, 14 AS DF, 15 AS VM, 16 AS HM)
)
ORDER BY DOT_NUMBER") # Jessie created a table in her schema.
census <- dbGetQuery(conn = con, statement = qry)
dim(census) #2871   18
names(census)
census$Utlization <- census$RECENT_MILEAGE/census$AVG_POWER_UNIT
# Crash rate by ranking and category ----
qry <- paste0("SELECT GM_CO2_RANK, SMARTWAY_RANKING_CATEGORY,
--CASE WHEN GM_CO2_RANK IN (1,2,3,4) THEN 'HIGH' ELSE 'LOW' END RANK,
CASE WHEN GM_CO2_RANK IN (1) THEN 'HIGH' ELSE 'LOW' END RANK,
COUNT(*) NBR_CARRIER
, SUM(AVG_POWER_UNIT) PU, ROUND(SUM(AVG_POWER_UNIT)/COUNT(*),2) AVG_PU, SUM(CRASH_TOTAL) CRASH
, ROUND(SUM(CRASH_TOTAL)*100/SUM(AVG_POWER_UNIT),2) CRASH_RATE
, ROUND(SUM(fatal_crash_total)*100/SUM(AVG_POWER_UNIT),2) FATAL_CRASH_RATE
, ROUND(SUM(inj_crash_total)*100/SUM(AVG_POWER_UNIT),2) INJURY_CRASH_RATE
, ROUND(SUM(towaway_crash_total)*100/SUM(AVG_POWER_UNIT),2) TOWAWAY_CRASH_RATE
FROM JESSIEYANG.SMARTWAY_JOIN_MCMIS
WHERE passes_crash_filter = 'Y'
GROUP BY GM_CO2_RANK, SMARTWAY_RANKING_CATEGORY
ORDER BY GM_CO2_RANK, SMARTWAY_RANKING_CATEGORY"
)
cr_rank_cat <- dbGetQuery(conn = con, statement = qry)
dim(cr_rank_cat) #62*11
# Crash rate by ranking and category and carrier type/size ----
qry <- paste0("SELECT GM_CO2_RANK, SMARTWAY_RANKING_CATEGORY, CARRIER_GROUP_ID, PU_GROUP,
--CASE WHEN GM_CO2_RANK IN (1,2,3,4) THEN 'HIGH' ELSE 'LOW' END RANK,
CASE WHEN GM_CO2_RANK IN (1) THEN 'HIGH' ELSE 'LOW' END RANK,
COUNT(*) NBR_CARRIER
, SUM(AVG_POWER_UNIT) PU, ROUND(SUM(AVG_POWER_UNIT)/COUNT(*),2) AVG_PU, SUM(CRASH_TOTAL) CRASH
, ROUND(SUM(CRASH_TOTAL)*100/SUM(AVG_POWER_UNIT),2) CRASH_RATE
, ROUND(SUM(fatal_crash_total)*100/SUM(AVG_POWER_UNIT),2) FATAL_CRASH_RATE
, ROUND(SUM(inj_crash_total)*100/SUM(AVG_POWER_UNIT),2) INJURY_CRASH_RATE
, ROUND(SUM(towaway_crash_total)*100/SUM(AVG_POWER_UNIT),2) TOWAWAY_CRASH_RATE
FROM JESSIEYANG.SMARTWAY_JOIN_MCMIS
WHERE passes_crash_filter = 'Y'
GROUP BY GM_CO2_RANK, SMARTWAY_RANKING_CATEGORY,CARRIER_GROUP_ID, PU_GROUP
ORDER BY GM_CO2_RANK, SMARTWAY_RANKING_CATEGORY,CARRIER_GROUP_ID, PU_GROUP"
)
cr_type_size <- dbGetQuery(conn = con, statement = qry)
cr_type_size$CARRIER_GROUP_ID <- as.factor(cr_type_size$CARRIER_GROUP_ID)
dim(cr_type_size) #62*11
View(census)
names(census)
ggplot(census, aes(UD_PERCENTILE, GM_CO2_RANK, colour = SMARTWAY_RANKING_CATEGORY,
group = SMARTWAY_RANKING_CATEGORY)) +
geom_line() + geom_point() + geom_count() +
facet_wrap(~ SMARTWAY_RANKING_CATEGORY)+
theme(legend.position="none")
ggplot(census, aes(UD_PERCENTILE, GM_CO2_RANK, colour = CARRIER_GROUP_ID,
group = SMARTWAY_RANKING_CATEGORY)) +
geom_line() + geom_point() + geom_count() +
facet_wrap(~ SMARTWAY_RANKING_CATEGORY)
# Load data
qry <- paste0("WITH my_data AS (
SELECT A.*, B.PERCENTILE, B.RD_DEFICIENT, B.BASIC_ID
FROM SMARTWAY_JOIN_MCMIS A,     CSA.HIST_CARRIER_MEASURE B,
(SELECT DOT_NUMBER, ROUND(NVL(fatal_crash_total,0)/AVG_POWER_UNIT,2) FATAL_CR,
ROUND(NVL(inj_crash_total,0)/AVG_POWER_UNIT,2) INJURY_CR,
ROUND(NVL(towaway_crash_total,0)/AVG_POWER_UNIT,2) TOWAWAY_CR
FROM CSA.HIST_CARRIER
WHERE dot_number IN (SELECT DOT_NUMBER FROM CC_JOINED_LIST_NACFE
WHERE CR_INCLUDE = 'Y')) C
WHERE A.DOT_NUMBER = B.DOT_NUMBER
AND A.DOT_NUMBER = C.DOT_NUMBER
AND B.RELEASED_ID = 181
)
SELECT *
FROM my_data
PIVOT (
MAX( PERCENTILE) As PERCENTILE,
MAX( RD_DEFICIENT ) as RD_DEFICIENT
FOR BASIC_ID IN (11 as UD, 12 As HOS , 13 As DA, 14 AS DF, 15 AS VM, 16 AS HM)
)
ORDER BY DOT_NUMBER") # Jessie created a table in her schema.
census <- dbGetQuery(conn = con, statement = qry)
dim(census) #2871   18
names(census)
census$Utlization <- census$RECENT_MILEAGE/census$AVG_POWER_UNIT
census$CARRIER_GROUP_ID <- as.factor(census$CARRIER_GROUP_ID)
# Crash rate by ranking and category ----
qry <- paste0("SELECT GM_CO2_RANK, SMARTWAY_RANKING_CATEGORY,
--CASE WHEN GM_CO2_RANK IN (1,2,3,4) THEN 'HIGH' ELSE 'LOW' END RANK,
CASE WHEN GM_CO2_RANK IN (1) THEN 'HIGH' ELSE 'LOW' END RANK,
COUNT(*) NBR_CARRIER
, SUM(AVG_POWER_UNIT) PU, ROUND(SUM(AVG_POWER_UNIT)/COUNT(*),2) AVG_PU, SUM(CRASH_TOTAL) CRASH
, ROUND(SUM(CRASH_TOTAL)*100/SUM(AVG_POWER_UNIT),2) CRASH_RATE
, ROUND(SUM(fatal_crash_total)*100/SUM(AVG_POWER_UNIT),2) FATAL_CRASH_RATE
, ROUND(SUM(inj_crash_total)*100/SUM(AVG_POWER_UNIT),2) INJURY_CRASH_RATE
, ROUND(SUM(towaway_crash_total)*100/SUM(AVG_POWER_UNIT),2) TOWAWAY_CRASH_RATE
FROM JESSIEYANG.SMARTWAY_JOIN_MCMIS
WHERE passes_crash_filter = 'Y'
GROUP BY GM_CO2_RANK, SMARTWAY_RANKING_CATEGORY
ORDER BY GM_CO2_RANK, SMARTWAY_RANKING_CATEGORY"
)
cr_rank_cat <- dbGetQuery(conn = con, statement = qry)
dim(cr_rank_cat) #62*11
# Crash rate by ranking and category and carrier type/size ----
qry <- paste0("SELECT GM_CO2_RANK, SMARTWAY_RANKING_CATEGORY, CARRIER_GROUP_ID, PU_GROUP,
--CASE WHEN GM_CO2_RANK IN (1,2,3,4) THEN 'HIGH' ELSE 'LOW' END RANK,
CASE WHEN GM_CO2_RANK IN (1) THEN 'HIGH' ELSE 'LOW' END RANK,
COUNT(*) NBR_CARRIER
, SUM(AVG_POWER_UNIT) PU, ROUND(SUM(AVG_POWER_UNIT)/COUNT(*),2) AVG_PU, SUM(CRASH_TOTAL) CRASH
, ROUND(SUM(CRASH_TOTAL)*100/SUM(AVG_POWER_UNIT),2) CRASH_RATE
, ROUND(SUM(fatal_crash_total)*100/SUM(AVG_POWER_UNIT),2) FATAL_CRASH_RATE
, ROUND(SUM(inj_crash_total)*100/SUM(AVG_POWER_UNIT),2) INJURY_CRASH_RATE
, ROUND(SUM(towaway_crash_total)*100/SUM(AVG_POWER_UNIT),2) TOWAWAY_CRASH_RATE
FROM JESSIEYANG.SMARTWAY_JOIN_MCMIS
WHERE passes_crash_filter = 'Y'
GROUP BY GM_CO2_RANK, SMARTWAY_RANKING_CATEGORY,CARRIER_GROUP_ID, PU_GROUP
ORDER BY GM_CO2_RANK, SMARTWAY_RANKING_CATEGORY,CARRIER_GROUP_ID, PU_GROUP"
)
cr_type_size <- dbGetQuery(conn = con, statement = qry)
cr_type_size$CARRIER_GROUP_ID <- as.factor(cr_type_size$CARRIER_GROUP_ID)
dim(cr_type_size) #62*11
ggplot(census, aes(UD_PERCENTILE, GM_CO2_RANK, colour = CARRIER_GROUP_ID,
group = SMARTWAY_RANKING_CATEGORY)) +
geom_line() + geom_point() + geom_count() +
facet_wrap(~ SMARTWAY_RANKING_CATEGORY)
ggplot(census, aes(HOS_PERCENTILE, GM_CO2_RANK, colour = CARRIER_GROUP_ID,
group = SMARTWAY_RANKING_CATEGORY)) +
geom_line() + geom_point() + geom_count() +
facet_wrap(~ SMARTWAY_RANKING_CATEGORY)
ggplot(census, aes(UD_PERCENTILE, GM_CO2_RANK, colour = CARRIER_GROUP_ID,
group = SMARTWAY_RANKING_CATEGORY)) +
geom_line() + geom_point() + geom_count() +
facet_wrap(~ SMARTWAY_RANKING_CATEGORY)+
theme(legend.position="none")
ggplot(census, aes(HOS_PERCENTILE, GM_PM_RANK, colour = SMARTWAY_RANKING_CATEGORY,
group = SMARTWAY_RANKING_CATEGORY)) +
geom_line() + geom_point() + geom_count() +
facet_wrap(~ SMARTWAY_RANKING_CATEGORY)+
theme(legend.position="none")
ggplot(census, aes(HOS_PERCENTILE, GM_PM_RANK, colour = CARRIER_GROUP_ID,
group = SMARTWAY_RANKING_CATEGORY)) +
geom_line() + geom_point() + geom_count() +
facet_wrap(~ SMARTWAY_RANKING_CATEGORY)+
theme(legend.position="none")
ggplot(census, aes(DA_PERCENTILE, GM_PM_RANK, colour = CARRIER_GROUP_ID,
group = SMARTWAY_RANKING_CATEGORY)) +
geom_line() + geom_point() + geom_count() +
facet_wrap(~ SMARTWAY_RANKING_CATEGORY)+
theme(legend.position="none")
ggplot(census, aes(DF_PERCENTILE, GM_PM_RANK, colour = CARRIER_GROUP_ID,
group = SMARTWAY_RANKING_CATEGORY)) +
geom_line() + geom_point() + geom_count() +
facet_wrap(~ SMARTWAY_RANKING_CATEGORY)+
theme(legend.position="none")
ggplot(census, aes(VM_PERCENTILE, GM_PM_RANK, colour = CARRIER_GROUP_ID,
group = SMARTWAY_RANKING_CATEGORY)) +
geom_line() + geom_point() + geom_count() +
facet_wrap(~ SMARTWAY_RANKING_CATEGORY)+
theme(legend.position="none")
ggplot(census, aes(HM_PERCENTILE, GM_PM_RANK, colour = CARRIER_GROUP_ID,
group = SMARTWAY_RANKING_CATEGORY)) +
geom_line() + geom_point() + geom_count() +
facet_wrap(~ SMARTWAY_RANKING_CATEGORY)+
theme(legend.position="none")
ggplot(census, aes(UD_PERCENTILE, GM_CO2_RANK, colour = CARRIER_GROUP_ID,
group = SMARTWAY_RANKING_CATEGORY)) +
geom_line() + geom_point() + geom_count() +
facet_wrap(~ SMARTWAY_RANKING_CATEGORY)+
theme(legend.position="none")
ggplot(census, aes(HOS_PERCENTILE, GM_CO2_RANK, colour = CARRIER_GROUP_ID,
group = SMARTWAY_RANKING_CATEGORY)) +
geom_line() + geom_point() + geom_count() +
facet_wrap(~ SMARTWAY_RANKING_CATEGORY)+
theme(legend.position="none")
ggplot(census, aes(DA_PERCENTILE, GM_CO2_RANK, colour = CARRIER_GROUP_ID,
group = SMARTWAY_RANKING_CATEGORY)) +
geom_line() + geom_point() + geom_count() +
facet_wrap(~ SMARTWAY_RANKING_CATEGORY)+
theme(legend.position="none")
ggplot(census, aes(DF_PERCENTILE, GM_CO2_RANK, colour = CARRIER_GROUP_ID,
group = SMARTWAY_RANKING_CATEGORY)) +
geom_line() + geom_point() + geom_count() +
facet_wrap(~ SMARTWAY_RANKING_CATEGORY)+
theme(legend.position="none")
ggplot(census, aes(VM_PERCENTILE, GM_CO2_RANK, colour = CARRIER_GROUP_ID,
group = SMARTWAY_RANKING_CATEGORY)) +
geom_line() + geom_point() + geom_count() +
facet_wrap(~ SMARTWAY_RANKING_CATEGORY)+
theme(legend.position="none")
ggplot(census, aes(HM_PERCENTILE, GM_CO2_RANK, colour = CARRIER_GROUP_ID,
group = SMARTWAY_RANKING_CATEGORY)) +
geom_line() + geom_point() + geom_count() +
facet_wrap(~ SMARTWAY_RANKING_CATEGORY)+
theme(legend.position="none")
# Load data
qry <- paste0("WITH my_data AS (
SELECT A.*, B.PERCENTILE, B.RD_DEFICIENT, B.BASIC_ID FROM SMARTWAY_JOIN_MCMIS A,
CSA.HIST_CARRIER_MEASURE B,
(SELECT DOT_NUMBER, ROUND(NVL(fatal_crash_total,0)/AVG_POWER_UNIT,2) FATAL_CR,
ROUND(NVL(inj_crash_total,0)/AVG_POWER_UNIT,2) INJURY_CR,
ROUND(NVL(towaway_crash_total,0)/AVG_POWER_UNIT,2) TOWAWAY_CR
FROM CSA.HIST_CARRIER) C
WHERE A.DOT_NUMBER = B.DOT_NUMBER
AND A.DOT_NUMBER = C.DOT_NUMBER
AND B.RELEASED_ID = 181
)
SELECT *
FROM my_data
PIVOT (
MAX( PERCENTILE) As PERCENTILE,
MAX( RD_DEFICIENT ) as RD_DEFICIENT
FOR BASIC_ID IN (11 as UD, 12 As HOS , 13 As DA, 14 AS DF, 15 AS VM, 16 AS HM)
)
ORDER BY DOT_NUMBER") # Jessie created a table in her schema.
census <- dbGetQuery(conn = con, statement = qry)
dim(census) #2871   18
names(census)
census$Utlization <- census$RECENT_MILEAGE/census$AVG_POWER_UNIT
census$CARRIER_GROUP_ID <- as.factor(census$CARRIER_GROUP_ID)
# Crash rate by ranking and category ----
qry <- paste0("SELECT GM_CO2_RANK, SMARTWAY_RANKING_CATEGORY,
--CASE WHEN GM_CO2_RANK IN (1,2,3,4) THEN 'HIGH' ELSE 'LOW' END RANK,
CASE WHEN GM_CO2_RANK IN (1) THEN 'HIGH' ELSE 'LOW' END RANK,
COUNT(*) NBR_CARRIER
, SUM(AVG_POWER_UNIT) PU, ROUND(SUM(AVG_POWER_UNIT)/COUNT(*),2) AVG_PU, SUM(CRASH_TOTAL) CRASH
, ROUND(SUM(CRASH_TOTAL)*100/SUM(AVG_POWER_UNIT),2) CRASH_RATE
, ROUND(SUM(fatal_crash_total)*100/SUM(AVG_POWER_UNIT),2) FATAL_CRASH_RATE
, ROUND(SUM(inj_crash_total)*100/SUM(AVG_POWER_UNIT),2) INJURY_CRASH_RATE
, ROUND(SUM(towaway_crash_total)*100/SUM(AVG_POWER_UNIT),2) TOWAWAY_CRASH_RATE
FROM JESSIEYANG.SMARTWAY_JOIN_MCMIS
WHERE passes_crash_filter = 'Y'
GROUP BY GM_CO2_RANK, SMARTWAY_RANKING_CATEGORY
ORDER BY GM_CO2_RANK, SMARTWAY_RANKING_CATEGORY"
)
cr_rank_cat <- dbGetQuery(conn = con, statement = qry)
dim(cr_rank_cat) #62*11
# Crash rate by ranking and category and carrier type/size ----
qry <- paste0("SELECT GM_CO2_RANK, SMARTWAY_RANKING_CATEGORY, CARRIER_GROUP_ID, PU_GROUP,
--CASE WHEN GM_CO2_RANK IN (1,2,3,4) THEN 'HIGH' ELSE 'LOW' END RANK,
CASE WHEN GM_CO2_RANK IN (1) THEN 'HIGH' ELSE 'LOW' END RANK,
COUNT(*) NBR_CARRIER
, SUM(AVG_POWER_UNIT) PU, ROUND(SUM(AVG_POWER_UNIT)/COUNT(*),2) AVG_PU, SUM(CRASH_TOTAL) CRASH
, ROUND(SUM(CRASH_TOTAL)*100/SUM(AVG_POWER_UNIT),2) CRASH_RATE
, ROUND(SUM(fatal_crash_total)*100/SUM(AVG_POWER_UNIT),2) FATAL_CRASH_RATE
, ROUND(SUM(inj_crash_total)*100/SUM(AVG_POWER_UNIT),2) INJURY_CRASH_RATE
, ROUND(SUM(towaway_crash_total)*100/SUM(AVG_POWER_UNIT),2) TOWAWAY_CRASH_RATE
FROM JESSIEYANG.SMARTWAY_JOIN_MCMIS
WHERE passes_crash_filter = 'Y'
GROUP BY GM_CO2_RANK, SMARTWAY_RANKING_CATEGORY,CARRIER_GROUP_ID, PU_GROUP
ORDER BY GM_CO2_RANK, SMARTWAY_RANKING_CATEGORY,CARRIER_GROUP_ID, PU_GROUP"
)
cr_type_size <- dbGetQuery(conn = con, statement = qry)
cr_type_size$CARRIER_GROUP_ID <- as.factor(cr_type_size$CARRIER_GROUP_ID)
dim(cr_type_size) #62*11
ggplot(census, aes(GTM_CO2_RANK, GTM_PM_RANK, colour = SMARTWAY_RANKING_CATEGORY, group = SMARTWAY_RANKING_CATEGORY)) +
#geom_line() +
geom_density_2d() +
geom_point() +
geom_count() +
facet_wrap(~ SMARTWAY_RANKING_CATEGORY)
ggplot(census, aes(GM_CO2_RANK, GTM_CO2_RANK, colour = SMARTWAY_RANKING_CATEGORY, group = SMARTWAY_RANKING_CATEGORY)) +
#geom_line() +
geom_density_2d() +
geom_point() +
geom_count() +
facet_wrap(~ SMARTWAY_RANKING_CATEGORY)
knitr::opts_chunk$set(echo = TRUE)
library(dplyr)
library(ggplot2)
library(ROracle)
library(getPass)
# log into MCMIS
drv <- dbDriver('Oracle')
con <- dbConnect(drv, getPass('username'), getPass('password'),'AIDBDEV')
# Load data
qry <- paste0("WITH my_data AS (
SELECT A.*, B.PERCENTILE, B.RD_DEFICIENT, B.BASIC_ID FROM SMARTWAY_JOIN_MCMIS A,
CSA.HIST_CARRIER_MEASURE B,
(SELECT DOT_NUMBER, ROUND(NVL(fatal_crash_total,0)/AVG_POWER_UNIT,2) FATAL_CR,
ROUND(NVL(inj_crash_total,0)/AVG_POWER_UNIT,2) INJURY_CR,
ROUND(NVL(towaway_crash_total,0)/AVG_POWER_UNIT,2) TOWAWAY_CR
FROM CSA.HIST_CARRIER) C
WHERE A.DOT_NUMBER = B.DOT_NUMBER
AND A.DOT_NUMBER = C.DOT_NUMBER
AND B.RELEASED_ID = 181
)
SELECT *
FROM my_data
PIVOT (
MAX( PERCENTILE) As PERCENTILE,
MAX( RD_DEFICIENT ) as RD_DEFICIENT
FOR BASIC_ID IN (11 as UD, 12 As HOS , 13 As DA, 14 AS DF, 15 AS VM, 16 AS HM)
)
ORDER BY DOT_NUMBER") # Jessie created a table in her schema.
census <- dbGetQuery(conn = con, statement = qry)
dim(census) #2871   18
names(census)
census$Utlization <- census$RECENT_MILEAGE/census$AVG_POWER_UNIT
census$CARRIER_GROUP_ID <- as.factor(census$CARRIER_GROUP_ID)
# Crash rate by ranking and category ----
qry <- paste0("SELECT GM_CO2_RANK, SMARTWAY_RANKING_CATEGORY,
--CASE WHEN GM_CO2_RANK IN (1,2,3,4) THEN 'HIGH' ELSE 'LOW' END RANK,
CASE WHEN GM_CO2_RANK IN (1) THEN 'HIGH' ELSE 'LOW' END RANK,
COUNT(*) NBR_CARRIER
, SUM(AVG_POWER_UNIT) PU, ROUND(SUM(AVG_POWER_UNIT)/COUNT(*),2) AVG_PU, SUM(CRASH_TOTAL) CRASH
, ROUND(SUM(CRASH_TOTAL)*100/SUM(AVG_POWER_UNIT),2) CRASH_RATE
, ROUND(SUM(fatal_crash_total)*100/SUM(AVG_POWER_UNIT),2) FATAL_CRASH_RATE
, ROUND(SUM(inj_crash_total)*100/SUM(AVG_POWER_UNIT),2) INJURY_CRASH_RATE
, ROUND(SUM(towaway_crash_total)*100/SUM(AVG_POWER_UNIT),2) TOWAWAY_CRASH_RATE
FROM JESSIEYANG.SMARTWAY_JOIN_MCMIS
WHERE passes_crash_filter = 'Y'
GROUP BY GM_CO2_RANK, SMARTWAY_RANKING_CATEGORY
ORDER BY GM_CO2_RANK, SMARTWAY_RANKING_CATEGORY"
)
cr_rank_cat <- dbGetQuery(conn = con, statement = qry)
dim(cr_rank_cat) #62*11
# Crash rate by ranking and category and carrier type/size ----
qry <- paste0("SELECT GM_CO2_RANK, SMARTWAY_RANKING_CATEGORY, CARRIER_GROUP_ID, PU_GROUP,
--CASE WHEN GM_CO2_RANK IN (1,2,3,4) THEN 'HIGH' ELSE 'LOW' END RANK,
CASE WHEN GM_CO2_RANK IN (1) THEN 'HIGH' ELSE 'LOW' END RANK,
COUNT(*) NBR_CARRIER
, SUM(AVG_POWER_UNIT) PU, ROUND(SUM(AVG_POWER_UNIT)/COUNT(*),2) AVG_PU, SUM(CRASH_TOTAL) CRASH
, ROUND(SUM(CRASH_TOTAL)*100/SUM(AVG_POWER_UNIT),2) CRASH_RATE
, ROUND(SUM(fatal_crash_total)*100/SUM(AVG_POWER_UNIT),2) FATAL_CRASH_RATE
, ROUND(SUM(inj_crash_total)*100/SUM(AVG_POWER_UNIT),2) INJURY_CRASH_RATE
, ROUND(SUM(towaway_crash_total)*100/SUM(AVG_POWER_UNIT),2) TOWAWAY_CRASH_RATE
FROM JESSIEYANG.SMARTWAY_JOIN_MCMIS
WHERE passes_crash_filter = 'Y'
GROUP BY GM_CO2_RANK, SMARTWAY_RANKING_CATEGORY,CARRIER_GROUP_ID, PU_GROUP
ORDER BY GM_CO2_RANK, SMARTWAY_RANKING_CATEGORY,CARRIER_GROUP_ID, PU_GROUP"
)
cr_type_size <- dbGetQuery(conn = con, statement = qry)
cr_type_size$CARRIER_GROUP_ID <- as.factor(cr_type_size$CARRIER_GROUP_ID)
dim(cr_type_size) #62*11
# Boxplot on Nbr Carriers
ggplot(cr_rank_cat,
aes(SMARTWAY_RANKING_CATEGORY, NBR_CARRIER)) +
geom_boxplot()
ggplot(cr_rank_cat,
aes(as.character(GM_CO2_RANK), NBR_CARRIER)) +
geom_boxplot() + xlab("GM_CO2_RANK")
# plots using census data - no relationship observed.
ggplot(census, aes(GTM_CO2_RANK, GTM_PM_RANK, colour = SMARTWAY_RANKING_CATEGORY, group = SMARTWAY_RANKING_CATEGORY)) +
#geom_line() +
geom_density_2d() +
geom_point() +
geom_count() +
facet_wrap(~ SMARTWAY_RANKING_CATEGORY)
#theme(legend.position="none")
# A few categories show strong positive relationship bewteen GM_CO2_RANK and GTM_CO2_RANK:
# Flatbed, regrigerated, TL(Truck load)/Dry Van
ggplot(census, aes(GM_CO2_RANK, GTM_CO2_RANK, colour = SMARTWAY_RANKING_CATEGORY, group = SMARTWAY_RANKING_CATEGORY)) +
#geom_line() +
geom_density_2d() +
geom_point() +
geom_count() +
facet_wrap(~ SMARTWAY_RANKING_CATEGORY)
#theme(legend.position="none")
#ggplot(census, aes(GM_CO2, GTM_CO2, colour = SMARTWAY_RANKING_CATEGORY, group = SMARTWAY_RANKING_CATEGORY)) +
#geom_line() +
#  geom_density_2d() +
#  geom_point() +
#  geom_count() +
#  facet_wrap(~ SMARTWAY_RANKING_CATEGORY)
#theme(legend.position="none")
